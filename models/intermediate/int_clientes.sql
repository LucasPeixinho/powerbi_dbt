SELECT
    CODCLI,
    CLIENTE,

    -- Tratamento da DTPRIMCOMPRA
    CASE
        WHEN DTPRIMCOMPRA IS NULL
          OR TO_NUMBER(SUBSTR(DTPRIMCOMPRA, 7, 4)) < 1900
          OR TO_NUMBER(SUBSTR(DTPRIMCOMPRA, 7, 4)) > EXTRACT(YEAR FROM SYSDATE)
        THEN TO_DATE('01/01/1900', 'DD/MM/YYYY')
        ELSE TO_DATE(DTPRIMCOMPRA, 'DD/MM/YYYY')
    END AS DTPRIMCOMPRA_TRATADA,

    -- Tratamento da INICIOATIV
    CASE
        WHEN INICIOATIV IS NULL
          OR TO_NUMBER(SUBSTR(INICIOATIV, 7, 4)) < 1900
          OR TO_NUMBER(SUBSTR(INICIOATIV, 7, 4)) > EXTRACT(YEAR FROM SYSDATE)
        THEN TO_DATE('01/01/1900', 'DD/MM/YYYY')
        ELSE TO_DATE(INICIOATIV, 'DD/MM/YYYY')
    END AS INICIOATIV_TRATADA,

    BAIRROCOM,
    CASE
        WHEN TIPOFJ = 'F' THEN 'Física'
        ELSE 'Jurídica'
    END AS TIPO_CLIENTE

FROM {{ ref('stg_clientes')}} 